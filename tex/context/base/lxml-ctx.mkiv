%D \module
%D   [       file=lxml-ini,
%D        version=2007.08.17,
%D          title=\CONTEXT\ \XML\ Support,
%D       subtitle=Initialization,
%D         author=Hans Hagen,
%D           date=\currentdate,
%D      copyright={PRAGMA / Hans Hagen \& Ton Otten}]
%C
%C This module is part of the \CONTEXT\ macro||package and is
%C therefore copyrighted by \PRAGMA. See mreadme.pdf for
%C details.

%D Experimental. This might change! Also, it might become a module
%D instead if core code.

\writestatus{loading}{ConTeXt XML Support / Goodies}

\registerctxluafile{lxml-ctx}{1.001}

\unprotect

% the letterbar is a messy hack and is needed for the tabulate

\settrue \xmllshowbuffer
\setfalse\xmllshowtitle
\settrue \xmllshowwarning

\definehead[lshowtitle][subsubsubsubsubject]
\setuphead[lshowtitle][style=\tta]

% \unexpanded\def\setuplxmlshow[#1]%
%   {\dodoubleargument\getparameters[\??xl]}

\def\xmllshow#1%
  {\begingroup
   \let|=\letterbar
   \ctxlua{xml.ctx.tshow {
        pattern = \!!bs#1\!!es,
        \ifconditional\xmllshowtitle
            title = "lshowtitle",
        \fi
        \ifconditional\xmllshowwarning
            warning = true,
        \fi
    } }%
   \endgroup}

\def\xmllshowbuffer#1#2#3%
  {\begingroup
   \let|=\letterbar
   \ctxlua{xml.ctx.tshow {
        pattern = \!!bs#2\!!es,
        \ifconditional\xmllshowbuffer
            xmlroot = "#1",
            attribute = "#3",
        \fi
        \ifconditional\xmllshowwarning
            warning = true,
        \fi
     } }%
   \endgroup}

\protect
