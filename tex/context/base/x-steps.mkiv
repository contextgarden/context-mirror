%D \module
%D   [       file=m-steps,
%D        version=2001.05.28,
%D          title=\CONTEXT\ Modules,
%D       subtitle=Step Charts \& Tables,
%D         author=Hans Hagen,
%D           date=\currentdate,
%D      copyright={PRAGMA ADE \& \CONTEXT\ Development Team}]
%C
%C This module is part of the \CONTEXT\ macro||package and is
%C therefore copyrighted by \PRAGMA. See mreadme.pdf for
%C details.

%D The \XML\ interface. This module can be made way more efficient
%D in \MKIV\ using textext but it makes only sense to do this when
%D I really need it in a demanding application. Probably half of the
%D code in m-steps.tex can go.

\usemodule[m][steps]

\unprotect

\def\xmlstepchartdirective#1{\executeifdefined{@@stepchart@@#1}\gobbletwoarguments} % {#2}{#3}
\def\xmlsteptabledirective#1{\executeifdefined{@@steptable@@#1}\gobbletwoarguments} % {#2}{#3}

\setvalue{@@stepchart@@charts}{\setsomevalue\@@STPC}
\setvalue{@@stepchart@@cells}{\setsomevalue\@@STEC}
\setvalue{@@stepchart@@texts}{\setsomevalue\@@STET}
\setvalue{@@stepchart@@lines}{\setsomevalue\@@STEL}

\setvalue{@@steptable@@tables}{\setsomevalue\@@STPT}
\setvalue{@@steptable@@cells}{\setsomevalue\@@STEC}
\setvalue{@@steptable@@texts}{\setsomevalue\@@STET}
\setvalue{@@steptable@@lines}{\setsomevalue\@@STEL}

\startxmlsetups xml:ct:define
    \xmlsetsetup {#1} {ct:*} {xml:ct:*}
    \xmlsetsetup {#1} {ct:stepaligntable/cells} {xml:ct:stepaligntable:cells}
    \xmlsetsetup {#1} {ct:stepaligntable/lines} {xml:ct:stepaligntable:lines}
\stopxmlsetups

\xmlregisterns{ct}{stepcharts}

\xmlregistersetup{xml:ct:define}

\startxmlsetups xml:ct:prep
    \expanded{\prep[\xmltoparameters{#1}]}{\xmlflush{#1}}
\stopxmlsetups

\startxmlsetups xml:ct:text
    \expanded{\text[\xmltoparameters{#1}]}{\xmlflush{#1}}
\stopxmlsetups

\startxmlsetups xml:ct:texts
    \expanded{\texts[\xmltoparameters{#1}]}{\xmltext{#1}{/top}} {\xmltext{#1}{/bot}}
\stopxmlsetups

\startxmlsetups xml:ct:cell
    \expanded{\cell[\xmltoparameters{#1}]}{\xmlflush{#1}}
\stopxmlsetups

\startxmlsetups xml:ct:cells
    \expanded{\cells[\xmltoparameters{#1}]}{\xmltext{#1}{/top}} {\xmltext{#1}{/bot}}
\stopxmlsetups

\startxmlsetups xml:ct:lines
    \expanded{\startlines[\xmltoparameters{#1}]}
        \xmlflush{#1}
    \stoplines
\stopxmlsetups

\startxmlsetups xml:ct:steptable
    \expanded{\startSTEPtable[\xmltoparameters{#1}]}
        \xmlflush{#1}
    \stopSTEPtable
\stopxmlsetups

\startxmlsetups xml:ct:stepchart
    \expanded{\startSTEPchart[\xmltoparameters{#1}]}
        \xmlflush{#1}
    \stopSTEPchart
\stopxmlsetups

\startxmlsetups xml:ct:stepaligntable
    \expanded{\startSTEPaligntable[\xmltoparameters{#1}]}
        \xmlflush{#1}
    \stopSTEPaligntable
\stopxmlsetups

\startxmlsetups xml:ct:stepaligntable:cells
    \expanded{\cells[\xmltoparameters{#1}]} {\xmltext{#1}{/ct:c1}} {\xmltext{#1}{/ct:c2}} {\xmltext{#1}{/ct:c3}}
\stopxmlsetups

\startxmlsetups xml:ct:stepaligntable:lines
    \expanded{\setupSTEPlines[\xmltoparameters{#1}]}
    \xmlflush{#1}
\stopxmlsetups

\protect \endinput
